<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Admin Panel</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="static/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="static/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="static/vendors/select2/select2.min.css">
    <link rel="stylesheet" href="static/vendors/select2-bootstrap-theme/select2-bootstrap.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="static/css/horizontal-layout-light/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="static/images/favicon.png" />
</head>

<body class="sidebar-dark" style="font-family: 'Oxygen', sans-serif;">
    <div class="container-fluid page-body-wrapper">
        <!-- Header -->
        <header>
            <!-- Header content goes here -->
            {% include "header.html" %}
        </header>

        <div class="main-panel">
            <div class="content-wrapper">
                <div class="row">
                    <div class="col-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Add new Market</h4>

                                <form class="forms-sample" id="marketForm">

                                    <div class="form-group" >
                                        <label for="marketId">Market Id</label>
                                        <input  type="text" class="form-control" id="marketId" required readonly>
                                    </div>

                                    <div class="form-group">
                                        <label for="marketName">Market Name</label>
                                        <input  type="text" class="form-control" id="marketName" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="openTime">Open Time (Enter time in 24H format)</label>
                                        <input type="text" class="form-control" id="openTime" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="closeTime">Close Time (Enter time in 24H format)</label>
                                        <input type="text" class="form-control" id="closeTime" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="resultTime">Result Time (Enter time in 24H format)</label>
                                        <input type="text" class="form-control" id="resultTime" required>
                                    </div>

                                    <button type="submit" class="btn btn-primary mr-2 mt-4" style="width: 100%">Submit</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <!-- Footer content goes here -->
        </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    <!-- JavaScript Libraries -->
    <script src="static/vendors/js/vendor.bundle.base.js"></script>

    <!-- Custom JavaScript -->
    <!-- <script src="static/js/pages/add_market.js"></script> -->

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const name = urlParams.get('name');
        const open_time = urlParams.get('open_time');
        const close_time = urlParams.get('close_time');
        const result_time = urlParams.get('result_time');


         document.getElementById('marketId').value = id;
        document.getElementById('marketName').value = name;
        document.getElementById('openTime').value = open_time;
        document.getElementById('closeTime').value = close_time;
        document.getElementById('resultTime').value = result_time;




        // Function to handle form submission
 document.getElementById("marketForm").addEventListener("submit", function(event) {
    event.preventDefault();

    // Get form data
    var ed_id = document.getElementById("marketId").value;
    var ed_name = document.getElementById("marketName").value;
    var ed_openTime = document.getElementById("openTime").value;
    var ed_closeTime = document.getElementById("closeTime").value;
    var ed_resultTime = document.getElementById("resultTime").value;

    // Make AJAX request to submit form data
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/admin_edit_market", true);
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onload = function() {
        if (xhr.status == 201) {
            // Process success response here
            var response = JSON.parse(xhr.responseText);
            console.log(response);
            alert(response.message);
        } else {
            // Process error response here
            var errorResponse = JSON.parse(xhr.responseText);
            alert("Error: " + errorResponse.error);
        }
    };

    xhr.onerror = function() {
        // Display error message
        alert("Error: Request failed");
    };

    // Send form data as JSON
    xhr.send(JSON.stringify({market_id:ed_id , name: ed_name, open_time: ed_openTime, close_time: ed_closeTime, result_time: ed_resultTime }));
});
    </script>

</body>

</html>
